<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>JOUE MA VIE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FF85C1" />
</head>
<body>
  <div class="game">

    <!-- ONBOARDING : pseudo -->
    <section id="onboardingScreen" class="hidden">
      <h1>ğŸ® JOUE MA VIE</h1>
      <div class="card">
        <h2>Choisis ton pseudo</h2>
        <input id="playerNameInput" type="text" placeholder="Ex : Agathe" maxlength="24" />
        <button id="startBtn">Commencer</button>
      </div>
    </section>

    <!-- HOME -->
    <section id="homeScreen" class="hidden">
      <header class="topbar">
        <h1>ğŸ® Joue ma vie</h1>
        <button id="openSettingsBtn" class="icon-btn" aria-label="ParamÃ¨tres">âš™ï¸</button>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="homeStats">ğŸ“Š Stats</button>
        <button class="tab-btn" data-tab="homeWorlds">ğŸŒ Mondes</button>
      </div>

      <!-- Onglet stats -->
      <div id="homeStats" class="tab-panel">
        <div class="card">
          <p><strong>Joueuse :</strong> <span id="playerName"></span></p>
          <p><strong>Niveau :</strong> <span id="globalLevel"></span></p>
          <p><strong>XP totale :</strong> <span id="globalXp"></span></p>
        </div>

        <div class="card">
          <h3>Objectif hebdomadaire</h3>
          <div class="segmented" id="weekLoadPicker">
            <button data-load="busy">ChargÃ©e</button>
            <button data-load="normal" class="active">Normale</button>
            <button data-load="light">LÃ©gÃ¨re</button>
          </div>
          <p><span id="weekXp"></span> / <span id="weekGoal"></span> XP</p>
          <div class="progress-bar"><div class="progress-fill" id="weekProgress">0%</div></div>
        </div>

        <div class="card">
          <h3>Objectif mensuel</h3>
          <p><span id="monthXp"></span> / <span id="monthGoal"></span> XP</p>
          <div class="progress-bar"><div class="progress-fill" id="monthProgress">0%</div></div>
        </div>
      </div>

      <!-- Onglet mondes -->
      <div id="homeWorlds" class="tab-panel hidden">
        <div id="worldsList" class="worlds-grid"></div>
        <button id="openAddWorldBtn">â• Ajouter un monde</button>

        <div id="addWorldModal" class="modal hidden" role="dialog" aria-modal="true">
          <div class="modal-content card">
            <h3>CrÃ©er un monde</h3>

            <label>Nom du monde</label>
            <input id="worldNameInput" placeholder="Ex : Sport" />

            <label>IcÃ´ne (emoji)</label>
            <input id="worldIconInput" placeholder="Ex : ğŸƒ" />

            <label>RÃ¨gle XP</label>
            <div class="inline">
              <input id="minutesBaseInput" type="number" min="1" inputmode="numeric" placeholder="Minutes" />
              <span>=</span>
              <input id="xpBaseInput" type="number" min="1" inputmode="numeric" placeholder="XP" />
            </div>

            <div class="actions">
              <button id="createWorldBtn">CrÃ©er</button>
              <button id="cancelWorldBtn" class="ghost">Annuler</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORLD -->
    <section id="worldScreen" class="hidden">
      <header class="topbar">
        <button id="backHomeBtn" class="icon-btn" aria-label="Retour">â†</button>
        <h2 id="worldHeaderTitle"></h2>
        <button id="worldQuickSettingsBtn" class="icon-btn" aria-label="ParamÃ¨tres monde">âš™ï¸</button>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="worldStats">ğŸ“Š Stats</button>
        <button class="tab-btn" data-tab="worldInput">â±ï¸ Saisie</button>
        <button class="tab-btn" data-tab="worldObjectives">ğŸ¯ Objectifs</button>
      </div>

      <div id="worldStats" class="tab-panel">
        <div class="card">
          <p><strong>Niveau du monde :</strong> <span id="worldLevel"></span></p>
          <p><strong>XP semaine :</strong> <span id="worldWeekXp"></span></p>
          <p><strong>XP totale :</strong> <span id="worldTotalXp"></span></p>
        </div>
        <div class="card">
          <p><strong>RÃ¨gle XP :</strong> <span id="worldRuleText"></span></p>
          <p><strong>Temps total :</strong> <span id="worldTotalTime"></span> min</p>
        </div>
      </div>

      <div id="worldInput" class="tab-panel hidden">
        <div class="card">
          <h3>Saisir du temps</h3>
          <input id="timeMinutesInput" type="number" min="1" inputmode="numeric" placeholder="Minutes (ex : 45)" />
          <button id="validateTimeBtn">Valider</button>
          <p class="hint" id="timePreview"></p>
        </div>
      </div>

      <div id="worldObjectives" class="tab-panel hidden">
        <div class="card">
          <h3>Objectifs</h3>
          <div id="objectivesList"></div>
        </div>

        <div class="card">
          <h3>Ajouter un objectif</h3>

          <label>Type</label>
          <select id="objectiveTypeSelect">
            <option value="repeatable">ğŸ” RÃ©pÃ©table</option>
            <option value="milestone">ğŸ“ˆ Palier</option>
            <option value="unique">â­ Unique</option>
          </select>

          <div id="objectiveFieldsRepeatable">
            <label>Nom</label>
            <input id="objNameInput" placeholder="Ex : Aller courir" />
            <label>RÃ©compense (XP)</label>
            <input id="objXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
          </div>

          <div id="objectiveFieldsUnique" class="hidden">
            <label>Nom</label>
            <input id="objNameUniqueInput" placeholder="Ex : Finir un marathon" />
            <label>RÃ©compense (XP)</label>
            <input id="objXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
          </div>

          <div id="objectiveFieldsMilestone" class="hidden">
            <label>Texte (2 parties)</label>
            <div class="inline">
              <input id="milestonePrefixInput" placeholder="Ex : Lire" />
              <input id="milestoneSuffixInput" placeholder="Ex : livres" />
            </div>

            <div class="card subtle">
              <p class="hint">Ajoute tes paliers dans lâ€™ordre (ex : 1 puis 5 puis 10). Le prochain palier apparaÃ®tra automatiquement.</p>
              <div class="inline">
                <input id="milestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier (ex : 1)" />
                <input id="milestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP (ex : 10)" />
              </div>
              <button id="addMilestoneStepBtn" class="ghost">â• Ajouter palier</button>
              <div id="milestoneStepsPreview" class="steps-preview"></div>
            </div>

            <button id="createMilestoneObjectiveBtn">CrÃ©er lâ€™objectif palier</button>
          </div>

          <button id="createObjectiveBtn">Ajouter</button>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsScreen" class="hidden">
      <header class="topbar">
        <button id="backFromSettingsBtn" class="icon-btn" aria-label="Retour">â†</button>
        <h2>âš™ï¸ ParamÃ¨tres</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="card">
        <h3>Objectifs</h3>
        <label>Objectif mensuel (XP)</label>
        <input id="monthGoalInput" type="number" min="1" inputmode="numeric" />

        <label>Objectifs hebdo (XP)</label>
        <div class="grid-3">
          <div>
            <div class="hint">Semaine chargÃ©e</div>
            <input id="weekGoalBusyInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine normale</div>
            <input id="weekGoalNormalInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine lÃ©gÃ¨re</div>
            <input id="weekGoalLightInput" type="number" min="1" inputmode="numeric" />
          </div>
        </div>
        <button id="saveGoalsBtn">Enregistrer</button>
      </div>

      <div class="card">
        <h3>Mondes</h3>
        <div id="manageWorldsList"></div>
      </div>

      <div class="card danger">
        <h3>RÃ©initialiser</h3>
        <p class="hint">Supprime toutes les donnÃ©es (pseudo, mondes, XPâ€¦).</p>
        <button id="resetGameBtn" class="danger-btn">ğŸ”¥ RÃ©initialiser le jeu</button>
      </div>
    </section>

    <!-- POPUP -->
    <div id="popup"></div>

  </div>

  <script src="js/main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>
